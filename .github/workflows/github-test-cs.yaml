name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
permissions:
  contents: write
on: [push]
jobs:
  test-codespace:
    runs-on: ubuntu-22.04
    env:
      RepositoryName: "codespaces-synchronizer"
      DT_TENANT: ${{ secrets.DT_TENANT }}
      DT_OPERATOR_TOKEN: ${{ secrets.DT_OPERATOR_TOKEN }}
      DT_INGEST_TOKEN: ${{ secrets.DT_INGEST_TOKEN }}
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Add .env file for running locally with VS Code extension
        run: |
            cd .devcontainer 
            cat <<EOF >> runlocal/.env
            DT_TENANT=$DT_TENANT
            DT_OPERATOR_TOKEN=$DT_OPERATOR_TOKEN
            DT_INGEST_TOKEN=$DT_INGEST_TOKEN
            EOF
            sed -i '/"runArgs": \["--init", "--privileged", "--network=host"\]/c\  "runArgs": ["--init", "--privileged", "--network=host", "--env-file",".devcontainer/runlocal/.env"]' devcontainer.json
            echo "This is the devcontainer.json config for reading local variables"; cat devcontainer.json
      - name: Test Codespace (devcontainer) build and run commands
        uses: devcontainers/ci@v0.3
        with:
          imageName: shinojosa/dt-enablement
          cacheFrom: shinojosa/dt-enablement
          push: never
          runCmd: |
            zsh .devcontainer/test/framework.sh